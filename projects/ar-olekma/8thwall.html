<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR –û–ª—ë–∫–º–∏–Ω—Å–∫ Pro - 8thWall Edition</title>
    
    <!-- 8thWall XR Web -->
    <script src="https://apps.8thwall.com/xrweb?appKey=–í–ê–®_8THWALL_APP_KEY"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- 8thWall Camera Pipeline -->
    <script defer src="https://cdn.8thwall.com/web/aframe/8frame-1.3.0.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #000;
        }
        
        #ar-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* UI –û–≤–µ—Ä–ª–µ–π */
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
        }
        
        .ui-overlay > * {
            pointer-events: auto;
        }
        
        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .location-info h1 {
            font-size: 24px;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .location-info p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* –°—Ç–∞—Ç—É—Å VPS */
        .vps-status {
            background: rgba(0,255,0,0.3);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .vps-status.inactive {
            background: rgba(255,0,0,0.3);
        }
        
        .vps-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #0f0;
            animation: blink 1s infinite;
        }
        
        .vps-status.inactive .vps-dot {
            background: #f00;
            animation: none;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* AR –ö–∞—Ä—Ç–æ—á–∫–∞ —Å Glassmorphism */
        .ar-card {
            position: absolute;
            bottom: 120px;
            left: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 24px;
            padding: 24px;
            color: white;
            transform: translateY(0);
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .ar-card.hidden {
            transform: translateY(150%);
        }
        
        .ar-card .year {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .ar-card h3 {
            font-size: 24px;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .ar-card p {
            font-size: 15px;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        .ar-card .photo-container {
            position: relative;
            width: 100%;
            height: 150px;
            margin-top: 16px;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .ar-card .photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* 3D –û–±—ä–µ–∫—Ç –ø—Ä–µ–≤—å—é */
        .object-preview {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-menu {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(20px);
            padding: 12px;
            border-radius: 32px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .menu-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .menu-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .menu-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 64px;
            height: 64px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            z-index: 1000;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
            color: white;
        }
        
        .start-screen h2 {
            font-size: 36px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .feature {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 14px;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 22px 70px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
            transition: transform 0.3s;
            margin-top: 30px;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
        }
        
        .watermark {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.5);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="start-screen" id="startScreen">
        <div style="font-size: 100px; margin-bottom: 20px;">üèõÔ∏è</div>
        
        <h2>AR –û–ª—ë–∫–º–∏–Ω—Å–∫ Pro</h2>
        <p style="opacity: 0.8; font-size: 18px;">–ò—Å—Ç–æ—Ä–∏—è –æ–∂–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ –∫–∞–º–µ—Ä—É</p>
        
        <div class="features">
            <div class="feature">üìç VPS –Ω–∞–≤–∏–≥–∞—Ü–∏—è</div>
            <div class="feature">ü•Ω 3D –º–æ–¥–µ–ª–∏</div>
            <div class="feature">üéÆ –ö–≤–µ—Å—Ç—ã</div>
            <div class="feature">üì∏ –§–æ—Ç–æ AR</div>
        </div>
        
        <button class="start-btn" onclick="startAR()">
            –ó–∞–ø—É—Å—Ç–∏—Ç—å AR
        </button>
        
        <div class="watermark">
            üîí 8thWall Development Mode
        </div>
        
        <p style="margin-top: 40px; font-size: 12px; opacity: 0.6;">
            –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 8thWall ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
        </p>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading" id="loading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ AR...</p>
        <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 8thWall Engine</p>
    </div>

    <!-- AR –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä 8thWall -->
    <div id="ar-container">
        <div id="xr-canvas-container"></div>
    </div>

    <!-- UI –û–≤–µ—Ä–ª–µ–π -->
    <div class="ui-overlay" id="uiOverlay" style="display: none;">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="top-bar">
            <div class="location-info">
                <h1>üèõÔ∏è –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã</h1>
                <p>üìç –û–ª—ë–∫–º–∏–Ω—Å–∫ ‚Ä¢ <span id="distance">50 –º</span></p>
            </div>
            
            <div class="vps-status" id="vpsStatus">
                <div class="vps-dot"></div>
                <span>VPS –∞–∫—Ç–∏–≤–µ–Ω</span>
            </div>
            
            <button class="close-btn" onclick="closeAR()">√ó</button>
        </div>
        
        <!-- –ü—Ä–µ–≤—å—é 3D –æ–±—ä–µ–∫—Ç–∞ -->
        <div class="object-preview">
            üèõÔ∏è
        </div>

        <!-- AR –ö–∞—Ä—Ç–æ—á–∫–∞ -->
        <div class="ar-card" id="arCard">
            <span class="year">1985 –≥–æ–¥</span>
            <h3>–î–æ–º –ö—É–ª—å—Ç—É—Ä—ã ¬´–ì–∞—Ä–º–æ–Ω–∏—è¬ª</h3>
            <p>–í 1980-–µ –≥–æ–¥—ã –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã –±—ã–ª —Ü–µ–Ω—Ç—Ä–æ–º –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∂–∏–∑–Ω–∏ –≥–æ—Ä–æ–¥–∞. –ó–¥–µ—Å—å –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ –≤–µ—á–µ—Ä—ã.</p>
            
            <div class="photo-container">
                <img src="https://via.placeholder.com/400x150/667eea/ffffff?text=–î–ö+1985" 
                     alt="–î–ö 1985" class="photo"
                     onerror="this.style.display='none'; this.parentElement.innerHTML='üèõÔ∏è'">
            </div>
        </div>
        
        <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
        <div class="bottom-menu">
            <button class="menu-btn" onclick="toggleQuest()" title="–ö–≤–µ—Å—Ç">
                üéØ
            </button>
            
            <button class="menu-btn primary" onclick="capturePhoto()" title="–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ">
                üì∏
            </button>
            
            <button class="menu-btn" onclick="nextLocation()" title="–°–ª–µ–¥—É—é—â–∞—è –ª–æ–∫–∞—Ü–∏—è">
                ‚û°Ô∏è
            </button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 8thWall
        const CONFIG = {
            appKey: '–í–ê–®_8THWALL_APP_KEY', // –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á!
            imageTargets: ['dk-marker', 'naberezhnaya-marker'],
            vpsWaypoints: [
                { id: 'dk', lat: 60.366, lng: 120.416, name: '–î–æ–º –ö—É–ª—å—Ç—É—Ä—ã' },
                { id: 'nab', lat: 60.367, lng: 120.418, name: '–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è' },
                { id: 'school', lat: 60.368, lng: 120.415, name: '–®–∫–æ–ª–∞ ‚Ññ1' }
            ]
        };

        let engine = null;
        let currentLocation = 0;

        const locations = [
            {
                id: 'dk',
                name: '–î–æ–º –ö—É–ª—å—Ç—É—Ä—ã ¬´–ì–∞—Ä–º–æ–Ω–∏—è¬ª',
                year: '1985',
                description: '–í 1980-–µ –≥–æ–¥—ã –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã –±—ã–ª —Ü–µ–Ω—Ç—Ä–æ–º –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∂–∏–∑–Ω–∏ –≥–æ—Ä–æ–¥–∞. –ó–¥–µ—Å—å –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ –≤–µ—á–µ—Ä—ã.',
                coords: { lat: 60.366, lng: 120.416 }
            },
            {
                id: 'nab',
                name: '–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –õ–µ–Ω—ã',
                year: '1970',
                description: '–°—Ç–∞—Ä–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è –¥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π. –ó–¥–µ—Å—å –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å –≥–æ—Ä–æ–¥—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –∏ —Å–æ–±—Ä–∞–Ω–∏—è.',
                coords: { lat: 60.367, lng: 120.418 }
            },
            {
                id: 'school',
                name: '–®–∫–æ–ª–∞ ‚Ññ1 –∏–º. –Ø–∫–æ–≤–ª–µ–≤–∞',
                year: '1950',
                description: '–ü–µ—Ä–≤–∞—è —à–∫–æ–ª–∞ –≥–æ—Ä–æ–¥–∞, –æ—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1930-—Ö –≥–æ–¥–∞—Ö. –í—ã–ø—É—Å—Ç–∏–ª–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∂–∏—Ç–µ–ª–µ–π –û–ª—ë–∫–º–∏–Ω—Å–∫–∞.',
                coords: { lat: 60.368, lng: 120.415 }
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 8thWall
        async function init8thWall() {
            if (CONFIG.appKey === '–í–ê–®_8THWALL_APP_KEY') {
                console.warn('‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å 8thWall APP_KEY');
                alert('–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–µ–Ω –∫–ª—é—á 8thWall.\n\n1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ 8thwall.com\n2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\n3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ –∫–æ–¥');
                return false;
            }

            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–∫–∞
                if (window.XR8) {
                    await window.XR8.configure({
                        appKey: CONFIG.appKey,
                        cameraConfig: { direction: XR8.XrConfig.camera().BACK }
                    });
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS
                    setupVPS();
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Image Targets
                    setupImageTargets();
                    
                    return true;
                }
            } catch (e) {
                console.error('8thWall –æ—à–∏–±–∫–∞:', e);
                return false;
            }
        }

        function setupVPS() {
            // Visual Positioning System
            console.log('VPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
        }

        function setupImageTargets() {
            // –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            console.log('Image Targets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
        }

        function updatePosition(position) {
            const { latitude, longitude } = position.coords;
            
            let minDist = Infinity;
            let nearestIdx = 0;
            
            locations.forEach((loc, idx) => {
                const dist = calculateDistance(latitude, longitude, loc.coords.lat, loc.coords.lng);
                if (dist < minDist) {
                    minDist = dist;
                    nearestIdx = idx;
                }
            });
            
            const distMeters = Math.round(minDist * 1000);
            document.getElementById('distance').textContent = distMeters + ' –º';
            
            if (distMeters < 100 && currentLocation !== nearestIdx) {
                currentLocation = nearestIdx;
                showLocation(nearestIdx);
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function showLocation(index) {
            const loc = locations[index];
            document.querySelector('.ar-card .year').textContent = loc.year + ' –≥–æ–¥';
            document.querySelector('.ar-card h3').textContent = loc.name;
            document.querySelector('.ar-card p').textContent = loc.description;
            document.querySelector('.location-info h1').textContent = 'üèõÔ∏è ' + loc.name;
        }

        // –°—Ç–∞—Ä—Ç AR
        async function startAR() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            const initialized = await init8thWall();
            
            // GPS
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updatePosition, null, {
                    enableHighAccuracy: true
                });
            }
            
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('uiOverlay').style.display = 'block';
            }, 2000);
        }

        // UI —Ñ—É–Ω–∫—Ü–∏–∏
        function toggleQuest() {
            alert('üéØ –ó–∞–≥–∞–¥–∫–∞:\n\n–í –∫–∞–∫–æ–º –≥–æ–¥—É –ø–æ—Å—Ç—Ä–æ–µ–Ω –î–æ–º –ö—É–ª—å—Ç—É—Ä—ã?\n\n(–í Development —Ä–µ–∂–∏–º–µ –∫–≤–µ—Å—Ç—ã —É–ø—Ä–æ—â–µ–Ω—ã)');
        }

        function capturePhoto() {
            alert('üì∏ –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç!\n\n#AR–û–ª—ë–∫–º–∏–Ω—Å–∫ #–ú–æ—è–û–ª—ë–∫–º–∞');
        }

        function nextLocation() {
            currentLocation = (currentLocation + 1) % locations.length;
            showLocation(currentLocation);
        }

        function closeAR() {
            if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å —ç–∫—Å–∫—É—Ä—Å–∏—é?')) {
                location.reload();
            }
        }
    </script>
</body>
</html>